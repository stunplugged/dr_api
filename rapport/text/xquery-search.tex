
\section{Find alle kategorierne til programserierne}
Brugeren af videoapplikationen skal have muligheden for at navigere igennem de forskellige 
programseries kategorierne der findes på tidspunktet. Funktionen i Figur \ref{xquerySearch:getProgramSeriesCategory} bruger en XPath udryk til at finde alle kategori navne i filen og funktionen distinct-value() selekterer kun unik navne. En for lykke returnerer kategorinavne som element med tag <category> og udover returnerer funktionen getProgramSeriesCategory() et element, <countCategory>, med antal af forskellige kategorier. 


\begin{figure}[ht]
%\centering
\begin{lstlisting}[style=FAKE_XQUERY, language=XQUERY]

declare function dr:getProgramSeriesCategory
  ( $programseriesFileName as xs:string) as element()*{
    
    let $progSerieLables := distinct-values(doc($programseriesFileName)/ArrayOfProgramSerie/ProgramSerie/Labels/string/text())
    return (
      <countCategory>{count($progSerieLables)}</countCategory>,
      (
      for $lable in $progSerieLables
        return <category>{$lable}</category>
      )
    )
};

\end{lstlisting}
\caption{Funktion til at finde navn af programserierne og samlet antal.}
\label{xquerySearch:getProgramSeriesCategory}
\end{figure}



\section{Find antal programserier pr. kategori}
Når en bruger vægler et kategoriet skal videoapplikationen viser antallet af programserier i kategoriet og forskellige informationer om de. I funktionen \ref{xquerySearch:countProgramSeriesOfCategory} finder den XPath udryk alle ProgramSerie elementer hvor element <string> i element <Labels> har den sammen værdi som det valgte kategori. Variablen \$progSeries holder en sekvens med alle fundet ProgramSerie elementer og ikke kun elementet <Labels> fordi /.. ved slutning af sekvensen vælger forældre elementet som er ProgramSerie. Den XQuery funktion count() taler antal af fundet ProgramSerie elementer. Denne information og alle de ProgramSerie elementer bliver returneret i elementet <programSeriesCategory>.

\begin{figure}[ht]
%\centering
\begin{lstlisting}[style=FAKE_XQUERY, language=XQUERY]

declare function dr:countProgramSeriesOfCategory
  ( $programseriesFileName as xs:string, $category as xs:string ) as element()*{
    
    let $progSeries := doc($programseriesFileName)/ArrayOfProgramSerie/ProgramSerie/Labels[string=$category]/..
    return (
      <programSeriesCategory>
        <nameCategory>{$category}</nameCategory>
        <countProgSeries>{count($progSeries)}</countProgSeries>
        {
         for $progSerie in $progSeries
           (:alternativ: return $progSerie/ancestor::node()[1]:)
           return $progSerie
         }
      </programSeriesCategory>
    )
};

\end{lstlisting}
\caption{Funktion til at finde alle programserierne af kategoriet og samlet antal.}
\label{xquerySearch:countProgramSeriesOfCategory}
\end{figure}


\section{Find alle videoer med i en specifik kategori}







\section{Find alle videoer inden for et specifikt tidsinterval}

Videoapplikationen skal have en søgefunktion hvor brugeren kan finde programserievideoer hvor udsendelse tidspunkt ligger inden for et specifikt tidsinterval. XQuery funktionen er vist i Figur \ref{xquerySearch:programSeriesVideoBroadcastDateInterval} og tager navnet af XML video filen, start og stop tidspunktet som argument. En for lykke læser tidsinformation i tagget <BroadcastTime> af hvert element ProgramSerieVideo og returnerer kun de ProgramSerieVideo elementer hvor udsendelse tidspunktet ligger inden for tidsintervallet. XQuery har to forskellige sammenligningsoperatorer, værdier sammenligningsoperatorer (f.eks. le, ge) som er beregnet til at sammenligne enkelte værdi og generelte sammenligningsoperatorer (f.eks. <=, =>) for at sammenligne sekvenser med flere værdier. I denne funktion blev brugt de første variant fordi der er kun enkelte værdier som skal sammenlignes. Det er nødvendig at tage højde for at tagget <BroadcastTime> kan være tomt. I denne situation vil cast fra "tomt" til xs:dateTime() giver en dynamisk fejl. XQuery er et funktionelt programmeringssprog og der medfølges at variabler er uforanderlig. Derfor bruges en hjælpefunktion, Figur \ref{xquerySearch:getBroadCastTime} som kontrollerer når tagget er tomt og dermed returnere en dummy date ("1900-01-01T00:00:00") ellers den fundet date, til at opdatere den interne variable \$broadCastTime.


\begin{figure}[ht]
%\centering
\begin{lstlisting}[style=FAKE_XQUERY, language=XQUERY]

declare function dr:programSeriesVideoBroadcastDateInterval
( $programseriesVideoFileName as xs:string, $dateStart as xs:dateTime, $dateStop as xs:dateTime) as element()*{
  for $progSerVideoElement in doc($programseriesVideoFileName)/ArrayOfProgramSerieVideo/ProgramSerieVideo
  let $broadCastTime := dr:getBroadCastTime($progSerVideoElement/BroadcastTime)
  where $broadCastTime ge $dateStart and $broadCastTime le $dateStop
  return $progSerVideoElement
}; 

\end{lstlisting}
\caption{Funktion til at finde videoer for et specifikt tidsinterval}
\label{xquerySearch:programSeriesVideoBroadcastDateInterval}
\end{figure}



\begin{figure}[ht]
%\centering
\begin{lstlisting}[style=FAKE_XQUERY, language=XQUERY]

declare function dr:getBroadCastTime
($broadCastTimeElement as element() ) as xs:dateTime{
  if( not($broadCastTimeElement/data()) ) then (
       (xs:dateTime("1900-01-01T00:00:00"))
    ) else (
      (xs:dateTime($broadCastTimeElement/data()))
    ) 
};

\end{lstlisting}
\caption{Funktion til at læse BroadcastTime}
\label{xquerySearch:getBroadCastTime}
\end{figure}





TODO: Insert stuff about xquery search

Description of each search and how it is solved

Done! Find programs between specific date intervals.
Done! Find all kinds of labels for prorgams.
Find the number of programs for each label.

Identisk! Find all kinds of broadcasting channels.
Find the number of programs for each channel.

Find all videos from a particular series of programs sorted by date.



